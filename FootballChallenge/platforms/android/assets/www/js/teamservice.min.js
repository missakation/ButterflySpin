angular.module("football.controllers").factory("TeamStores",function(){var n=[],t={},i={};return{GetMyTeams:function(t){var r=firebase.auth().currentUser,i=r.uid;if(i!==null||i==""||i===undefined)firebase.database().ref("/players/"+i+"/teams").on("value",function(i){n=[];i.forEach(function(t){var i=new Date,r;i.setMinutes(t.child("dateminute").val());i.setFullYear(t.child("dateyear").val());i.setMonth(t.child("datemonth").val());i.setHours(t.child("datehour").val());i.setDate(t.child("dateday").val());r={key:t.key,teamname:t.child("teamname").val(),teamphoto:t.child("teamphoto").val(),datecreated:i,badge:t.child("badge").val(),members:1,teamadmin:t.child("teamadmin").val(),favstadium:t.child("favstadium").val()};n.push(r)});t(n)});else t(n)},GetAllTeams:function(){return firebase.database().ref("/teams").once("value").then(function(n){var t=n.child("barca/teamphoto").val();n.forEach(function(n){var t={key:n.val(),teamname:n.child("teamname").val(),teamphoto:n.child("teamphoto").val(),datecreated:datecreated};TempItems.push(t)})}),TempItems},GetRecommendedOpponents:function(){return firebase.database().ref("/teams").once("value").then(function(n){var t=n.child("barca/teamphoto").val();n.forEach(function(n){var t={key:n.val(),teamname:n.child("teamname").val(),teamphoto:n.child("teamphoto").val(),datecreated:datecreated};TempItems.push(t)})}),TempItems},AddNewTeam:function(n,t){var v=firebase.auth().currentUser,i=v.uid,f=new Date,s=f.getFullYear(),h=f.getMonth(),c=f.getDate(),l=f.getHours(),a=f.getMinutes(),r,o;try{r={rating:1e3,status:"1",teamadmin:i,teamname:n.teamname,yellowcard:0,pteamsize:n.pteamsize,startmonday:7,startmondayend:23,starttuesday:7,starttuesdayend:23,startwednesday:7,startwednesdayend:23,startthursday:7,startthursdayend:23,startfriday:7,startfridayend:23,startsaturday:7,startsaturdayend:23,startsunday:7,startsundayend:23,favstadium:n.favstadium,favstadiumphoto:n.photo,homejersey:n.homejersey,awayjersey:n.awayjersey,badge:n.badge,rank:1500,numberofgames:0,wins:0,teamoffive:n.five,teamofsix:n.six,teamofseven:n.seven,teamofeight:n.eight,teamofnine:n.nine,teamoften:n.ten,teamofeleven:n.eleven,dateyear:s,datemonth:h,dateday:c,datehour:l,dateminute:a,players:{firstone:!0},captain:{firstone:!0},comments:""};r.players[i]={name:t.displayname,firstname:t.firstname,lastname:t.lastname,isadmin:!0};r.captain[i]={name:t.displayname,firstname:t.firstname,lastname:t.lastname,isadmin:!0};o={teamname:n.teamname,badge:n.badge,rank:1500,dateyear:s,datemonth:h,dateday:c,datehour:l,dateminute:a,favstadium:n.favstadium,favstadiumphoto:n.photo,homejersey:n.homejersey,awayjersey:n.awayjersey,players:{firstone:!0},teamadmin:i};o.players[i]={name:t.displayname,firstname:t.firstname,lastname:t.lastname,isadmin:"True"};var e=firebase.database().ref().child("teams").push().key,y={rank:1500,numberofgames:0,wins:0,badge:n.badge,name:n.teamname},u={};return(i!==null||i==""||i===undefined)&&(u["/teams/"+e]=r,u["/players/"+i+"/teams/"+e]=o,u["/teampoints/"+e]=y,u["/teaminfo/"+e]=r,u["/teamnames/"+r.teamname]=i),firebase.database().ref().update(u)}catch(p){alert(JSON.stringify(p))}},GetTeamByKey:function(n,i){try{firebase.database().ref("/teams/"+n).once("value").then(function(n){var f,r,o,c;if(t={},f=[],n.exists()){var s=[],h=[],e=!1,l=firebase.auth().currentUser,u=l.uid;u==n.child("teamadmin").val()&&(e=!0);n.child("captain").exists()&&n.child("captain").forEach(function(n){var t={key:n.key,name:n.child("name").val(),firstname:n.child("firstname").val(),lastname:n.child("lastname").val()};h.push(t)});n.child("players").exists()&&(n.child("players/"+u).exists()&&n.child("players/"+u+"/isadmin").val()&&(e=!0),n.child("players").forEach(function(n){if(n.key!="firstone"){var t={key:n.key,name:n.child("name").val(),firstname:n.child("firstname").val(),lastname:n.child("lastname").val(),isadmin:n.child("isadmin").val(),itsme:n.key==u,status:0};s.push(t)}}));r=new Date;r.setMinutes(n.child("dateminute").val());r.setFullYear(n.child("dateyear").val());r.setMonth(n.child("datemonth").val());r.setHours(n.child("datehour").val());r.setDate(n.child("dateday").val());o=0;n.child("upcominteamgmatches").exists()&&(o=n.child("upcominteamgmatches").numChildren(),n.child("upcominteamgmatches").forEach(function(n){var t=new Date,i;t.setMinutes(n.child("minute").val());t.setFullYear(n.child("year").val());t.setMonth(n.child("month").val());t.setHours(n.child("hour").val());t.setDate(n.child("day").val());i={key:n.key,accepted:n.child("accepted").val(),day:n.child("day").val(),hour:n.child("hour").val(),minute:n.child("minute").val(),month:n.child("month").val(),team1adminid:n.child("team1adminid").val(),team1key:n.child("team1key").val(),team1logo:n.child("team1logo").val(),team1name:n.child("team1name").val(),team1rank:n.child("team1rank").val(),team2adminid:n.child("team2adminid").val(),team2key:n.child("team2key").val(),team2logo:n.child("team2logo").val(),team2name:n.child("team2name").val(),team2rank:n.child("team2rank").val(),year:n.child("year").val(),date:t,stadiumkey:n.child("stadiumkey").val(),ministadiumkey:n.child("ministadiumkey").val(),photo:n.child("photo").val(),price:n.child("price").val(),stadiumdescription:n.child("stadiumdescription").val()};f.push(i)}));c={key:n.key,teamname:n.child("teamname").val(),badge:n.child("badge").val(),homejersey:n.child("homejersey").val(),awayjersey:n.child("awayjersey").val(),startmonday:n.child("startmonday").val(),startmondayend:n.child("startmondayend").val(),starttuesday:n.child("starttuesday").val(),starttuesdayend:n.child("starttuesdayend").val(),startwednesday:n.child("startwednesday").val(),startwednesdayend:n.child("startwednesdayend").val(),startthursday:n.child("startthursday").val(),startthursdayend:n.child("startthursdayend").val(),startfriday:n.child("startfriday").val(),startfridayend:n.child("startfridayend").val(),startsaturday:n.child("startsaturday").val(),startsaturdayend:n.child("startsaturdayend").val(),startsunday:n.child("startsunday").val(),startsundayend:n.child("startsundayend").val(),rating:1500,numberofgames:0,wins:0,amiadmin:e,players:s,captain:h,teamadmin:n.child("teamadmin").val(),accepted:!1,pending:!1,invite:!1,comments:n.child("comments").val(),datecreated:r,upcomingmatches:f,favstadium:n.child("favstadium").val(),favstadiumphoto:n.child("favstadiumphoto").val(),numChildren:o,teamoffive:n.child("teamoffive").val(),teamofsix:n.child("teamofsix").val(),teamofseven:n.child("teamofseven").val(),teamofeight:n.child("teamofeight").val(),teamofnine:n.child("teamofnine").val(),teamoften:n.child("teamoften").val(),teamofeleven:n.child("teamofeleven").val(),teamsizestring:"",available:n.child("available").val(),availablepng:n.child("available").val()?"available":"busy"};t=c}i(t)})}catch(r){alert(r.message)}},GetTeamInfoByKey:function(n,t){try{firebase.database().ref("/teaminfo/"+n).once("value").then(function(n){if(i={},n.exists()){var r=firebase.auth().currentUser,f=r.uid,u={key:n.key,teamname:n.child("teamname").val(),badge:n.child("badge").val(),homejersey:n.child("homejersey").val(),awayjersey:n.child("awayjersey").val(),rating:1500,rank:100};i=u}t(i)})}catch(r){alert(r.message)}},GetPlayersByTeam:function(n,t){try{firebase.database().ref("/teams/"+n+"/players").once("value").then(function(n){var i=[];if(n.exists()){var i=[],r=firebase.auth().currentUser,u=r.uid;n.forEach(function(n){if(n.key!="firstone"){var t={key:n.key,name:n.child("name").val(),isadmin:n.child("isadmin").val(),itsme:n.key==u};i.push(t)}})}alert(JSON.stringify(i));t(i)})}catch(i){alert(i.message)}},DeleteTeamByKey:function(n){var r,t,i;try{for(r=n.players,t={},t["/teams/"+n.key]=null,t["/teampoints/"+n.key]=null,t["/teaminfo/"+n.key]=null,i=0;i<r.length;i++)t["/players/"+r[i].key+"/teams/"+n.key]=null;return firebase.database().ref().update(t)}catch(u){alert(u.message)}return TempItems},UpdateTeamByKey:function(n){try{var t={},i=n.key;return t["teams/"+i+"/startmonday"]=n.startmonday,t["teams/"+i+"/startmondayend"]=n.startmondayend,t["teams/"+i+"/starttuesday"]=n.starttuesday,t["teams/"+i+"/starttuesdayend"]=n.starttuesdayend,t["teams/"+i+"/startwednesday"]=n.startwednesday,t["teams/"+i+"/startwednesdayend"]=n.startwednesdayend,t["teams/"+i+"/startthursday"]=n.startthursday,t["teams/"+i+"/startthursdayend"]=n.startthursdayend,t["teams/"+i+"/startfriday"]=n.startfriday,t["teams/"+i+"/startfridayend"]=n.startfridayend,t["teams/"+i+"/startsaturday"]=n.startsaturday,t["teams/"+i+"/startsaturdayend"]=n.startsaturdayend,t["teams/"+i+"/startsunday"]=n.startsunday,t["teams/"+i+"/startsundayend"]=n.startsundayend,t["teams/"+i+"/comments"]=n.comments,t["teams/"+i+"/favstadium"]=n.favstadium,t["teams/"+i+"/favstadiumphoto"]=n.favstadiumphoto,t["teams/"+i+"/available"]=n.available,t["teaminfo/"+i+"/startmonday"]=n.startmonday,t["teaminfo/"+i+"/startmondayend"]=n.startmondayend,t["teaminfo/"+i+"/starttuesday"]=n.starttuesday,t["teaminfo/"+i+"/starttuesdayend"]=n.starttuesdayend,t["teaminfo/"+i+"/startwednesday"]=n.startwednesday,t["teaminfo/"+i+"/startwednesdayend"]=n.startwednesdayend,t["teaminfo/"+i+"/startthursday"]=n.startthursday,t["teaminfo/"+i+"/startthursdayend"]=n.startthursdayend,t["teaminfo/"+i+"/startfriday"]=n.startfriday,t["teaminfo/"+i+"/startfridayend"]=n.startfridayend,t["teaminfo/"+i+"/startsaturday"]=n.startsaturday,t["teaminfo/"+i+"/startsaturdayend"]=n.startsaturdayend,t["teaminfo/"+i+"/startsunday"]=n.startsunday,t["teaminfo/"+i+"/startsundayend"]=n.startsundayend,t["teaminfo/"+i+"/comments"]=n.comments,t["teaminfo/"+i+"/favstadium"]=n.favstadium,t["teaminfo/"+i+"/favstadiumphoto"]=n.favstadiumphoto,t["teaminfo/"+i+"/available"]=n.available,firebase.database().ref().update(t)}catch(r){alert(r.message)}},PromoteDeletePlayers:function(n,t,i){try{var r={};switch(i){case 1:r["/teams/"+n.key+"/players/"+t.key+"/isadmin"]=!0;break;case 2:r["/teams/"+n.key+"/players/"+t.key+"/isadmin"]=!1;break;case 3:r["/teams/"+n.key+"/players/"+t.key]=null;r["/teams/"+n.key+"/admins/"+t.key]=null;r["/players/"+t.key+"/teams/"+n.key]=null;break;case 4:r["/teams/"+n.key+"/players/"+t.key]=t}return firebase.database().ref().update(r)}catch(u){alert(u.message)}},LeaveTeam:function(n){var r=firebase.auth().currentUser,t=r.uid,i;if(t!==null||t==""||t===undefined)try{return i={},i["/teams/"+n.key+"/players/"+t]=null,i["/teams/"+n.key+"/captain/"+t]=null,i["/players/"+t+"/teams/"+n.key]=null,firebase.database().ref().update(i)}catch(u){alert(u.message)}},InvitePlayerToTeam:function(n,t,i){try{var u={},r=new Date,f=r.getFullYear(),e=r.getMonth(),o=r.getDate(),s=r.getHours(),h=r.getMinutes(),c={key:n.key,teamname:n.teamname,badge:n.badge,homejersey:n.homejersey,awayjersey:n.awayjersey,year:f,month:e,day:o,hour:s,minute:h,status:0,dateyear:f,datemonth:e,dateday:o,datehour:s,dateminute:h,adminkey:i.key,admindisplayname:i.displayname,adminphoto:i.photo,admintelephone:i.telephone};return u["/players/"+t.key+"/teaminvitations/"+n.key]=c,firebase.database().ref().update(u)}catch(l){alert(l.message)}},GetTeamByName:function(n,t){try{firebase.database().ref("/teaminfo").orderByChild("teamname").equalTo(n).once("value").then(function(n){var i=!1;n.exists()&&(i=!0);t(i)})}catch(i){alert(i.message)}}}});