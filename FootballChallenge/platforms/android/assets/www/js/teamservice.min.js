angular.module("football.controllers").factory("TeamStores",function(){var n=[],t={};return{GetMyTeams:function(t){var i=firebase.auth().currentUser,r=i.uid;firebase.database().ref("/players/"+r+"/teams").on("value",function(i){n=[];i.forEach(function(t){var i=new Date,r;i.setMinutes(t.child("dateminute").val());i.setFullYear(t.child("dateyear").val());i.setMonth(t.child("datemonth").val());i.setHours(t.child("datehour").val());i.setDate(t.child("dateday").val());r={key:t.key,teamname:t.child("teamname").val(),teamphoto:t.child("teamphoto").val(),datecreated:i,badge:t.child("badge").val(),members:t.child("players").numChildren()};n.push(r)});t(n)})},GetAllTeams:function(){return firebase.database().ref("/teams").once("value").then(function(n){var t=n.child("barca/teamphoto").val();n.forEach(function(n){var t={key:n.val(),teamname:n.child("teamname").val(),teamphoto:n.child("teamphoto").val(),datecreated:datecreated};TempItems.push(t)})}),TempItems},AddNewTeam:function(n){var a=firebase.auth().currentUser,t=a.uid,i=new Date,o=i.getFullYear(),s=i.getMonth(),h=i.getDate(),c=i.getHours(),l=i.getMinutes(),r,f;try{r={rating:1e3,status:"1",teamadmin:t,teamname:n.teamname,yellowcard:0,pteamsize:n.pteamsize,startmonday:1,startmondayend:23,starttuesday:1,starttuesdayend:23,startwednesday:1,startwednesdayend:23,startthursday:1,startthursdayend:23,startfriday:1,startfridayend:23,startsaturday:1,startsaturdayend:23,startsunday:1,startsundayend:23,favstadium:n.favstadium,favstadiumphoto:n.photo,favstadium:n.favstadium,homejersey:n.homejersey,awayjersey:n.awayjersey,badge:n.badge,rank:1500,numberofgames:0,wins:0,five:n.five,six:n.six,seven:n.seven,eight:n.eight,nine:n.nine,ten:n.ten,eleven:n.eleven,dateyear:o,datemonth:s,dateday:h,datehour:c,dateminute:l};r.players[t]={name:"Missak",isadmin:"True"};r.captain[t]={name:"Missak",isadmin:"True"};f={teamname:n.teamname,badge:n.badge,rank:1500,dateyear:o,datemonth:s,dateday:h,datehour:c,dateminute:l};f.players[t]={name:"Missak",isadmin:"True"};var e=firebase.database().ref().child("teams").push().key,u={};return u["/teams/"+e]=r,u["/players/"+t+"/teams/"+e]=f,u["/teampoints/"+e]={rank:1500,numberofgames:0,wins:0},firebase.database().ref().update(u)}catch(v){alert(v.message)}},GetTeamByKey:function(n,i){try{firebase.database().ref("/teams/"+n).once("value").then(function(n){var e;if(t={},n.exists()){var r=[],u=[],f=!1,o=firebase.auth().currentUser,s=o.uid;s==n.child("teamadmin").val()&&(f=!0);n.child("captain").exists()&&n.child("captain").forEach(function(n){var t={key:n.key,name:n.child("name").val()};u.push(t)});n.child("players").exists()&&n.child("players").forEach(function(n){var t={key:n.key,name:n.child("name").val()};r.push(t)});e={key:n.key,teamname:n.child("teamname").val(),badge:n.child("badge").val(),homejersey:n.child("homejersey").val(),awayjersey:n.child("awayjersey").val(),startmonday:n.child("startmonday").val(),startmondayend:n.child("startmondayend").val(),starttuesday:n.child("starttuesday").val(),starttuesdayend:n.child("starttuesdayend").val(),startwednesday:n.child("startwednesday").val(),startwednesdayend:n.child("startwednesdayend").val(),startthursday:n.child("startthursday").val(),startthursdayend:n.child("startthursdayend").val(),startfriday:n.child("startfriday").val(),startfridayend:n.child("startfridayend").val(),startsaturday:n.child("startsaturday").val(),startsaturdayend:n.child("startsaturdayend").val(),startsunday:n.child("startsunday").val(),startsundayend:n.child("startsundayend").val(),rank:1500,numberofgames:0,wins:0,amiadmin:f,players:r,captain:u};t=e}i(t)})}catch(r){alert(r.message)}},DeleteTeamByKey:function(n){var r,t,i;try{for(r=n.players,t={},t["/teams/"+n.key]=null,i=0;i<r.length;i++)t["/players/"+r[i].key+"/teams/"+n.key]=null;return firebase.database().ref().update(t)}catch(u){alert(u.message)}return TempItems},UpdateTeamByKey:function(n){try{var t={},i=n.key;return t["teams/"+i+"/startmonday"]=n.startmonday,t["teams/"+i+"/startmondayend"]=n.startmondayend,t["teams/"+i+"/starttuesday"]=n.starttuesday,t["teams/"+i+"/starttuesdayend"]=n.starttuesdayend,t["teams/"+i+"/startwednesday"]=n.startwednesday,t["teams/"+i+"/startwednesdayend"]=n.startwednesdayend,t["teams/"+i+"/startthursday"]=n.startthursday,t["teams/"+i+"/startthursdayend"]=n.startthursdayend,t["teams/"+i+"/startfriday"]=n.startfriday,t["teams/"+i+"/startfridayend"]=n.startfridayend,t["teams/"+i+"/startsaturday"]=n.startsaturday,t["teams/"+i+"/startsaturdayend"]=n.startsaturdayend,t["teams/"+i+"/startsunday"]=n.startsunday,t["teams/"+i+"/startsundayend"]=n.startsundayend,firebase.database().ref().update(t)}catch(r){alert(r.message)}},PromoteDeletePlayers:function(n,t,i){var r={};switch(i){case 1:r["/teams/"+n.key+"/admins/"+t.key]=t;break;case 2:r["/teams/"+n.key+"/admins/"+t.key]=null;break;case 3:r["/teams/"+n.key+"/players/"+t.key]=null;r["/teams/"+n.key+"/admins/"+t.key]=null;break;case 4:r["/teams/"+n.key+"/players/"+t.key]=t}return firebase.database().ref().update(r)},InvitePlayerToTeam:function(n,t){try{var h=firebase.auth().currentUser,a=h.uid,r={},i=new Date,u=i.getFullYear(),f=i.getMonth(),e=i.getDate(),o=i.getHours(),s=i.getMinutes(),c={key:n.key,teamname:n.teamname,badge:n.badge,homejersey:n.homejersey,awayjersey:n.awayjersey,year:u,month:f,day:e,hour:o,minute:s,status:0,dateyear:u,datemonth:f,dateday:e,datehour:o,dateminute:s};return r["/players/"+t.key+"/teaminvitations/"+n.key]=c,firebase.database().ref().update(r)}catch(l){alert(l.message)}}}});